openapi: 3.0.3
info:
  title: Creditra Backend API
  version: 0.1.0
  description: >
    API Documentation for the Creditra Backend. All responses follow a unified envelope format:
    `{ data: any | null, error: string | null }`.

servers:
  - url: http://localhost:3000
    description: Local development server

paths:
  /health:
    get:
      summary: Health Check
      description: Returns the health status of the application.
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/credit/lines:
    get:
      summary: Get Credit Lines
      description: Returns all available credit lines.
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/credit/lines/{id}:
    get:
      summary: Get Credit Line by ID
      description: Returns details of a specific credit line.
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '404':
          description: Credit Line Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FailureResponse'

  /api/risk/evaluate:
    post:
      summary: Evaluate Risk
      description: Evaluates risk for a given wallet address.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - walletAddress
              properties:
                walletAddress:
                  type: string
                  example: 'GCKFBEIYV2U22IO2BJ4KVJOIP7XPWQGZBW3JXDC55CYIXB5NAXMCEKJ'
      responses:
        '200':
          description: Risk Evaluation Result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Bad Request (Missing walletAddress)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FailureResponse'

  /api/risk/history/{walletAddress}:
    get:
      summary: Get Risk Evaluation History
      description: Retrieves the history of risk evaluations for a given wallet address, including risk scores, credit limits, and timestamps.
      parameters:
        - name: walletAddress
          in: path
          required: true
          schema:
            type: string
            pattern: '^G[A-Z2-7]{55}$'
          description: Stellar wallet address (56 characters starting with 'G')
          example: 'GCKFBEIYV2U22IO2BJ4KVJOIP7XPWQGZBW3JXDC55CYIXB5NAXMCEKJ'
      responses:
        '200':
          description: Risk Evaluation History
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/SuccessResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          walletAddress:
                            type: string
                            description: The wallet address queried
                          evaluations:
                            type: array
                            description: Array of risk evaluations ordered by date (newest first)
                            items:
                              $ref: '#/components/schemas/RiskEvaluation'
              examples:
                withHistory:
                  summary: Wallet with evaluation history
                  value:
                    data:
                      walletAddress: 'GCKFBEIYV2U22IO2BJ4KVJOIP7XPWQGZBW3JXDC55CYIXB5NAXMCEKJ'
                      evaluations:
                        - id: '123e4567-e89b-12d3-a456-426614174001'
                          riskScore: 45
                          riskLevel: 'medium'
                          suggestedLimit: '10000.00'
                          interestRateBps: 500
                          inputs:
                            transactionCount: 100
                            avgBalance: 5000
                          evaluatedAt: '2026-02-26T10:00:00.000Z'
                        - id: '123e4567-e89b-12d3-a456-426614174002'
                          riskScore: 35
                          riskLevel: 'low'
                          suggestedLimit: '15000.00'
                          interestRateBps: 400
                          inputs: null
                          evaluatedAt: '2026-02-25T10:00:00.000Z'
                    error: null
                noHistory:
                  summary: Wallet with no evaluation history
                  value:
                    data:
                      walletAddress: 'GAAZI4TCR3TY5OJHCTJC2A4QSY6CJWJH5IAJTGKIN2ER7LBNVKOCCWN'
                      evaluations: []
                    error: null
        '400':
          description: Bad Request (Invalid wallet address)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FailureResponse'
              example:
                data: null
                error: 'Invalid wallet address: "BAD". Must start with ''G'' and be 56 alphanumeric characters.'

components:
  schemas:
    SuccessResponse:
      type: object
      properties:
        data:
          description: The payload of the successful response. Varies by endpoint.
          type: object
        error:
          description: Error message. Always null for successful responses.
          type: "null"
      required:
        - data
        - error

    FailureResponse:
      type: object
      properties:
        data:
          description: Data payload. Always null for failed responses.
          type: "null"
        error:
          description: The error message detailing what went wrong.
          type: string
      required:
        - data
        - error

    RiskEvaluation:
      type: object
      description: A single risk evaluation record
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for this evaluation
          example: '123e4567-e89b-12d3-a456-426614174001'
        riskScore:
          type: integer
          minimum: 0
          maximum: 100
          description: Numeric risk score (0-100)
          example: 45
        riskLevel:
          type: string
          enum: [low, medium, high]
          description: Risk level derived from score (low < 40, medium 40-69, high >= 70)
          example: 'medium'
        suggestedLimit:
          type: string
          description: Suggested credit limit as a decimal string
          example: '10000.00'
        interestRateBps:
          type: integer
          description: Suggested interest rate in basis points (1 bps = 0.01%)
          example: 500
        inputs:
          type: object
          nullable: true
          description: Optional snapshot of inputs used for this evaluation (supports future risk engine outputs)
          example:
            transactionCount: 100
            avgBalance: 5000
        evaluatedAt:
          type: string
          format: date-time
          description: ISO 8601 timestamp of when the evaluation was performed
          example: '2026-02-26T10:00:00.000Z'
      required:
        - id
        - riskScore
        - riskLevel
        - suggestedLimit
        - interestRateBps
        - inputs
        - evaluatedAt
